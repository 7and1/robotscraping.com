name = "robot-scraping-core"
main = "src/index.ts"
compatibility_date = "2024-10-01"
compatibility_flags = ["nodejs_compat"]

# Account ID is set via CLOUDFLARE_ACCOUNT_ID environment variable
# Or uncomment and set below (NOT recommended for public repos):
# account_id = "your-account-id-here"

# Browser binding
[browser]
binding = "MYBROWSER"

# D1 Database - set database_id via environment variable CLOUDFLARE_D1_DATABASE_ID
# Or replace after creation: npx wrangler d1 create robot-db
[[d1_databases]]
binding = "DB"
database_name = "robot-db"
database_id = "YOUR_D1_DATABASE_ID"  # Replace or use env var

# R2 Bucket
[[r2_buckets]]
binding = "BUCKET"
bucket_name = "robot-snapshots"

# Queue
[[queues.producers]]
queue = "robot-tasks"
binding = "TASK_QUEUE"

[[queues.consumers]]
queue = "robot-tasks"
max_batch_size = 1
max_batch_timeout = 60

# Cron trigger
[triggers]
crons = ["* * * * *"]

# Environment variables
[vars]
# AI Provider: openrouter (recommended), openai, anthropic
AI_PROVIDER = "openrouter"
OPENROUTER_MODEL = "meta-llama/llama-3.3-70b-instruct:free"
OPENROUTER_FALLBACK_MODEL_1 = "deepseek/deepseek-r1:free"
OPENROUTER_FALLBACK_MODEL_2 = "google/gemini-2.0-flash-exp:free"
# Legacy: OpenAI/Anthropic
# OPENAI_MODEL = "gpt-4o-mini"
# ANTHROPIC_MODEL = "claude-3-haiku-20240307"

MAX_CONTENT_CHARS = "20000"
BROWSER_TIMEOUT_MS = "15000"
CORS_ORIGIN = "https://robotscraping.com"  # Change to your domain
DEFAULT_SCREENSHOT = "false"
STORE_CONTENT = "true"
ALLOW_ANON = "false"
CACHE_ENABLED = "true"
CACHE_TTL_MS = "900000"
PROXY_GRID_ENABLED = "false"
PROXY_GRID_BASE_URL = "http://google.savedimage.com"
PROXY_GRID_ALLOWLIST = ""
PROXY_GRID_FORCE = "false"
RATE_LIMIT_ENABLED = "true"
RATE_LIMIT_REQUESTS = "60"
RATE_LIMIT_WINDOW_MS = "60000"
MAX_REQUEST_SIZE_MB = "10"
ENABLE_RATE_LIMIT_HEADERS = "true"

# Secrets (set via: npx wrangler secret put SECRET_NAME)
# Required for OpenRouter:
#   npx wrangler secret put OPENROUTER_API_KEY_1
#   npx wrangler secret put OPENROUTER_API_KEY_2  (optional, for rotation)
#   npx wrangler secret put OPENROUTER_API_KEY_3  (optional, for rotation)
# Legacy providers:
#   OPENAI_API_KEY, ANTHROPIC_API_KEY
# Optional: WEBHOOK_SECRET, PROXY_GRID_SECRET
